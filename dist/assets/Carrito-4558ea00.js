import{r as d,A as x,c as b,G as B,b as A,j as l,a}from"./index-39a70ab6.js";import{S as C}from"./sweetalert2.esm.all-6401f406.js";import"./keen-slider.min-9c2a669f.js";const E=()=>{const{auth:i,setAuth:f}=d.useContext(x),u=b(),m=new B,[p,h]=d.useState([]),[g,t]=d.useState(0),N=(e,o)=>{console.log(o),console.log(e),m.put("carrito",e.id,{cantidad:parseInt(o),producto:e.producto.id,usuario:e.usuario});let n=p,r=[],c=0;n.map(s=>{s.id==e.id?(e.cantidad=parseInt(o),r.push(e),c+=s.producto.price*e.cantidad):(r.push(s),c+=s.producto.price*s.cantidad)}),console.log(r),h(r),t(c)},w=e=>{console.log(e),m.delete("carrito",e.id);let o=p,n=[],r=0;o.map(c=>{c.id!=e.id&&(n.push(c),r+=c.producto.price*c.cantidad)}),h(n),t(r)};return d.useEffect(()=>{setTimeout(()=>{i?A({method:"get",url:"https://api.escuelajs.co/api/v1/products/"}).then(e=>{if(console.log(e),e.status==200){const o=e.data,n=[];let r=0;m.get("carrito",c=>{c.map(s=>{s.usuario==i.id&&o.map(v=>{v.id==s.producto&&(console.log(r),s.producto=v,r+=v.price*s.cantidad,n.push(s))})}),h(n),t(r)}),console.log(n)}}):C.mixin({}).fire({title:"Â¿tienes una cuenta?",icon:"warning",showCancelButton:!0,confirmButtonText:"login",cancelButtonText:"crear cuenta",reverseButtons:!0}).then(o=>{o.isConfirmed?u("/login"):o.dismiss===C.DismissReason.cancel?u("/registroUsuario"):u("/")})},3e3)},[]),l("div",{id:"Carrito",children:[a("div",{children:p.map((e,o)=>a(P,{p:e,evento:N,deletee:w}))}),l("div",{className:"Detalles",children:[a("div",{className:"D-C1",children:a("p",{children:"resumen de compra"})}),l("div",{className:"D-C2",children:[a("p",{children:"Total"}),l("p",{children:["$",g]})]}),a("div",{className:"D-C3",children:a("button",{onClick:()=>{window.location.replace("/comprar")},children:"comprar ahora"})})]})]})},P=({p:i,evento:f,deletee:u})=>{const[m,p]=d.useState(""),[h,g]=d.useState(i.cantidad);return d.useEffect(()=>{let t=i.producto.images[0];t=t.replaceAll("[",""),t=t.replaceAll("]",""),t=t.replaceAll('"',""),t=t.replaceAll("\\",""),p(t)},[]),l("div",{className:"Producto",children:[a("div",{className:"P-img",children:a("img",{src:m,alt:""})}),l("div",{className:"P-info",children:[a("div",{className:"info-title",children:a("p",{children:i.producto.title})}),l("div",{className:"info-btns",children:[a("button",{onClick:()=>u(i),children:"Eliminar"}),a("button",{onClick:()=>{window.location.replace("/comprar/"+i.producto.id)},children:"Comprar ahora"})]}),a("div",{className:"info-cantidad",children:a("input",{type:"number",min:0,value:h,onChange:t=>{t.target.value<0?(g(0),f(i,0)):(g(t.target.value),f(i,t.target.value))},name:"",id:""})}),a("div",{className:"info-price",children:l("p",{children:["$",i.producto.price*i.cantidad]})})]})]})};export{E as default};
